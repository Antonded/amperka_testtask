var _x1877=["./scriptDirector","fs","./libs/log","tftp","createServer","0.0.0.0","on","error","info","TFTP: request: ","file",".hex","status","waiting","updating","sendSocket","firmware","setUserExtensions","platform","pid","hex","setSize","length","end","abort","listen","addFirmware","uploaded firmware for "," ","addFirmwareFile","readFile","utf8","getState","getFirmware","setEnabled","getRoom","nodes","room","firmwareId","id","getEnabled","action","start"],_x50240=[_x1877[0],_x1877[1],_x1877[2],_x1877[3],_x1877[4],_x1877[5],_x1877[6],_x1877[7],_x1877[8],_x1877[9],_x1877[10],_x1877[11],_x1877[12],_x1877[13],_x1877[14],_x1877[15],_x1877[16],_x1877[17],_x1877[18],_x1877[19],_x1877[20],_x1877[21],_x1877[22],_x1877[23],_x1877[24],_x1877[25],_x1877[26],_x1877[27],_x1877[28],_x1877[29],_x1877[30],_x1877[31],_x1877[32],_x1877[33],_x1877[34],_x1877[35],_x1877[36],_x1877[37],_x1877[38],_x1877[39],_x1877[40],_x1877[41],_x1877[42]],scriptDirector=require(_x50240[0]),fs=require(_x50240[1]),log=require(_x50240[2])(module),enabled={},nodes={},firmware={},tftp=require(_x50240[3]),server=tftp[_x50240[4]]({host:_x50240[5],port:69,denyPUT:!0},function(x,_){x[_x50240[6]](_x50240[7],function(x){console[_x50240[7]](x)}),log[_x50240[8]](_x50240[9]+x[_x50240[10]]);var e=void 0;for(var r in nodes)for(var o in nodes[r])nodes[r][o]+_x50240[11]==x[_x50240[10]]&&(e=o);if(firmware[x[_x50240[10]]]&&firmware[x[_x50240[10]]][_x50240[12]]==_x50240[13]){firmware[x[_x50240[10]]][_x50240[12]]=_x50240[14],global[_x50240[15]]({eventType:_x50240[16],data:{node:e,status:firmware[x[_x50240[10]]][_x50240[12]]}}),_[_x50240[17]]({platform:process[_x50240[18]],pid:process[_x50240[19]]});var t=String(firmware[x[_x50240[10]]][_x50240[20]]);_[_x50240[21]](t[_x50240[22]]),_[_x50240[23]](t)}else x[_x50240[24]]()});server[_x50240[6]](_x50240[7],function(x){console[_x50240[7]](x)}),server[_x50240[25]](),exports[_x50240[26]]=function(x,_,e){log[_x50240[8]](_x50240[27]+x+_x50240[28]+_),nodes[x]&&nodes[x][_]&&(firmware[nodes[x][_]+_x50240[11]]={hex:e,status:_x50240[13]},global[_x50240[15]]({eventType:_x50240[16],data:{node:_,status:firmware[nodes[x][_]+_x50240[11]][_x50240[12]]}}))},exports[_x50240[29]]=function(x,_,e){var r=this;fs[_x50240[30]](e,_x50240[31],function(e,o){r[_x50240[26]](x,_,o)})},exports[_x50240[32]]=function(){var x={};for(var _ in nodes)for(var e in nodes[_])x[e]={room:_},firmware[nodes[_][e]+_x50240[11]]?x[e][_x50240[12]]=firmware[nodes[_][e]+_x50240[11]][_x50240[12]]:x[e][_x50240[12]]=_x50240[16];return x},exports[_x50240[33]]=function(x){return firmware[x]},exports[_x50240[34]]=function(x,_){if(enabled[x]=_,_){var e=scriptDirector[_x50240[35]](x);nodes[x]={};for(var r=0;r<e[_x50240[37]][_x50240[36]][_x50240[22]];r++)e[_x50240[37]][_x50240[36]][r][_x50240[38]]&&(nodes[x][e[_x50240[37]][_x50240[36]][r][_x50240[39]]]=e[_x50240[37]][_x50240[36]][r][_x50240[38]])}else nodes[x]=void 0},exports[_x50240[40]]=function(x){return enabled[x]},exports[_x50240[41]]=function(x,_){this[_x50240[34]](x,_==_x50240[42])};